<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Weekge ‚Äî University Syllabus Platform</title>

  <meta name="description" content="Weekge (Week.ge) ‚Äî ·É£·Éú·Éò·Éï·Éî·É†·É°·Éò·É¢·Éî·É¢·Éò·É° ·É°·Éê·Éí·Éú·Éî·Éë·Éò·É° ·Éì·Éê ·É°·Éò·Éö·Éê·Éë·É£·É°·Éî·Éë·Éò·É° ·Éû·Éö·Éê·É¢·É§·Éù·É†·Éõ·Éê. ·Éú·Éê·ÉÆ·Éî ·É®·Éî·Éú·Éò ·É°·Éê·Éí·Éú·Éî·Éë·Éò ·Éô·Éï·Éò·É†·Éî·Éë·Éò·É° ·Éõ·Éò·ÉÆ·Éî·Éì·Éï·Éò·Éó ·Éì·Éê ·Éò·Éù·Éö·Éò ·Éú·Éê·Éï·Éò·Éí·Éê·É™·Éò·Éò·Éó.">
  <meta name="theme-color" content="#0B1216">
  <link rel="icon" href="https://weekge.github.io/favicon.ico">

<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Georgian:wght@100..900&display=swap');

  :root {
    --bg: #0B1216;
    --top: #1C2A2F;
    --card: #2A3A40;
    --line: #83919922;
    --text: #EDEFF2;
    --muted: #B7C0C6;
    --accent: #F2C200;
    --done: #1ae63c;
    --pending: #6B7780;
    --danger: #ED3737;
    --subject-title: #2ad324;
    --shadow: 0 8px 28px rgba(0, 0, 0, .35);
    --defcolor: #16b438;
  }

  * { box-sizing: border-box; }
  html, body {
    overflow-y: hidden;
    height: 100%;
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: "Noto Sans Georgian", sans-serif;
  }

  ::-webkit-scrollbar { width: .3rem }
  ::-webkit-scrollbar-thumb { background: var(--defcolor); border-radius: 0px }

  /* === Loading Overlay === */
  #loadingOverlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: #0B1216;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity .3s ease, visibility .3s ease;
  }
  #loadingOverlay.hidden {
    opacity: 0;
    visibility: hidden;
  }
  #loadingOverlay .spinner {
    width: 100px;
    height: 100px;
    border: 10px solid rgba(255,255,255,.15);
    border-top: 10px solid var(--defcolor);
    border-radius: 50%;
    animation: spin 0.3s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  #loadingOverlay p {
    margin-top: 16px;
    opacity: .9;
  }

  /* NAV */
  .nav {
    position: sticky;
    top: 0;
    z-index: 50;
    height: 64px;
    background: var(--top);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    border-bottom: 1px solid #0006;
  }

  .brand { display: flex; align-items: center; gap: 10px; font-weight: 500; }
  .week-toggle {
    background: transparent; border: none; color: var(--text);
    font-size: 1rem; cursor: pointer; border-radius: 0;
  }

  .today-btn {
    background: var(--accent); color: #000; border: none;
    padding: 8px 14px; border-radius: 10px; font-weight: 700; cursor: pointer;
  }

  .signin-btn {
    background: #fff; color: #0B1216; border: none;
    padding: 10px 14px; border-radius: 999px; cursor: pointer;
  }

  .avatar {
    width: 42px; height: 42px; border-radius: 50%; border: 0;
    cursor: pointer; object-fit: cover; display: none; box-shadow: var(--shadow);
  }

  /* MENU */
  .menu {
    position: absolute; right: 16px; top: 64px;
    width: 220px; background: rgba(43,47,49,.9); backdrop-filter: blur(12px);
    box-shadow: var(--shadow); transform: translateY(-8px) scale(.95);
    opacity: 0; pointer-events: none; transition: opacity .25s, transform .25s;
    display: flex; flex-direction: column; align-items: center; text-align: center;
  }
  .menu.open { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }

  .menu a, .menu button {
    display: block; width: 100%; padding: 14px 0; background: transparent;
    border: none; color: #D7DBDE; font-size: 1rem; cursor: pointer; transition: background .2s;
  }
  .menu a:hover, .menu button:hover { background: rgba(255,255,255,0.1); }
  .menu .sep { height: 1px; width: 100%; background: #FFFFFF22; }

  /* LAYOUT */
  .wrap {
    height: calc(100% - 64px);
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 18px;
  }
  .left {
    border-right: 1px solid var(--line);
    padding: 10px 15px;
    overflow: auto;
    background: #0e161a;
    transition: transform .3s ease;
  }
  .right-panel { overflow: auto; }

  /* WEEKS LIST */
  .week-item {
    display: grid; grid-template-columns: 50px 1fr;
    align-items: center; gap: 10px; padding: 18px 8px;
    border-radius: 0; cursor: pointer;
  }
  .week-item.active { background: #1a2328; }
  .dot {
    width: 34px; height: 34px; border-radius: 50%;
    border: 5px solid #fff; background: var(--pending);
  }
  .dot.current { background: var(--accent); }
  .dot.done { background: var(--done); }

  .wk-title { font-weight: 500; margin-bottom: .2rem; }
  .wk-dates { font-size: 13px; color: var(--muted); }

  /* CARDS */
  #cardsCanvas { transition: opacity .35s ease, filter .35s ease; }
  .card-stack {
    display: flex; flex-direction: column; gap: 20px;
    max-width: 1200px; min-width: 700px; margin: 0 auto; padding: 20px;
  }
  .card {
    background: var(--card); border-radius: 0; box-shadow: var(--shadow);
    padding: 22px; border: 1px solid #0005;
    display: flex; flex-direction: column; gap: 16px;
  }
  .subhead { text-align: center; font-weight: 700; opacity: .9; margin-bottom: 4px; }
  .card-sections { display: flex; justify-content: space-between; align-items: stretch; gap: 16px; }
  .card-section {
    flex: 1; background: transparent; border: 1px solid rgba(255,255,255,.13);
    border-radius: 0; padding: 16px; display: flex; flex-direction: column;
    justify-content: space-between; transition: transform .2s, background .2s;
  }
  .card-section:hover { background: #ffffff05; }
  .card-section h4 { margin: 0 0 30px; font-weight: 700; color: var(--subject-title); font-size: 1rem; }

  .global-files {
    background: transparent;
    border: 1px solid rgba(255,255,255,.13);
    padding: 14px 16px;
  }
  .global-files h4 {
    margin-top: 0;
    margin-bottom: 10px;
    color: var(--subject-title);
    font-weight: 700;
  }

  .btns { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; }
  .pill {
    border: none; border-radius: 0px; padding: 10px 20px;
    font-weight: 700; cursor: pointer; font-size: .95rem; width: 100%;
  }

  .empty { opacity: .75; text-align: center; margin-top: 14vh; }

  /* MODAL */
  .modal{position:fixed;inset:0;z-index:200;background:rgba(11,18,22,.75);backdrop-filter:blur(12px);
    display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.35s;}
  .modal.open{opacity:1;pointer-events:auto;}
  .modal-inner{background:#121A1F;width:96%;max-width:1100px;height:92vh;box-shadow:0 8px 40px rgba(0,0,0,.4);
    transform:scale(.9);opacity:0;transition:.35s cubic-bezier(.22,1,.36,1);display:flex;flex-direction:column;overflow:hidden;}
  .modal.open .modal-inner{transform:scale(1);opacity:1;}
  .modal-head{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:#1C2A2F;border-bottom:1px solid #0005;}
  .close{background:0;color:#fff;border:0;padding:4px 8px;font-weight:700;cursor:pointer;font-size:1rem;}
  .modal-body{flex:1;overflow-y:auto;display:flex;flex-direction:column;padding-bottom:20px;}
  .catalog{flex:1;display:grid;grid-template-columns:minmax(0,1fr) minmax(350px,400px);gap:14px;padding:16px 20px;}
  .list,.sidebox{background:hsl(200,30%,7%);padding:10px;overflow:auto;}
  .search-box{background:#23343b;border:0;padding:10px 12px;color:var(--text);width:100%;margin-bottom:10px;font-size:1rem;outline:none;}
  #mySubjects{max-height:55vh;overflow-y:auto;}
  .item{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:8px 6px;border-bottom:1px solid #fff1;}
  .item button{background:#2e3a40;color:#fff;border:0;padding:10px 12px;cursor:pointer;min-width:100px;}
  .item .added{background:#38d98a;color:#111;}
  .save{width:100%;margin-top:10px;background:#38D98A;color:#111;border:none;padding:15px 10px;font-weight:700;cursor:pointer;font-size:1rem;}

  /* Responsive */
  @media(max-width:900px){
    .wrap{grid-template-columns:1fr;}
    .left{position:absolute;left:0;top:64px;bottom:0;width:100%;transform:translateY(-100%);z-index:30;}
    .left.open{transform:translateY(0);}
    .card-sections{flex-direction:column;}
    .card-stack{width:100%;max-width:100vw;min-width:50px;}
  }
  @media(min-width:901px){
    #weekToggle,#todayBtn{display:none!important;pointer-events:none;}
  }
</style>
</head>

<body>
<!-- ‚úÖ Loading Overlay -->
<div id="loadingOverlay">
  <div class="spinner"></div>
  <p>Loading Weekge...</p>
</div>

<div class="nav">
  <div class="brand">
    <button id="weekToggle" class="week-toggle">üìÖ Week ‚Äî</button>
    <button id="todayBtn" class="today-btn">Today</button>
  </div>
  <div class="right">
    <button id="signinBtn" class="signin-btn">Sign in with Google</button>
    <img id="avatar" class="avatar" src="" alt="profile" />
    <div id="menu" class="menu">
      <a id="openProfile">Profile Settings</a>
      <div class="sep"></div>
      <button id="logoutBtn">Log Out</button>
    </div>
  </div>
</div>

<div class="wrap">
  <div id="weeksList" class="left"></div>
  <div class="right-panel">
    <div id="cardsCanvas" class="card-stack">
      <div class="empty">·Éê·Éò·É†·É©·Éò·Éî ·Éõ·Éê·É†·É™·ÉÆ·Éú·Éò·Éï ·Éô·Éï·Éò·É†·Éê ·Éê·Éú ·É©·Éê·É†·Éó·Éî ·É°·Éê·Éí·Éú·Éî·Éë·Éò Profile Settings-·É®·Éò.</div>
    </div>
  </div>
</div>

<!-- ‚úÖ Profile Popup -->
<div id="modal" class="modal">
  <div class="modal-inner">
    <div class="modal-head">
      <div>Profile Settings</div>
      <button id="closeModal" class="close">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="catalog">
        <div class="list">
          <input type="text" id="searchCatalog" class="search-box" placeholder="·Éõ·Éù·É´·Éî·Éë·Éú·Éî ·É°·Éê·Éí·Éê·Éú·Éò">
          <div id="catalogList"><div class="empty">·Éò·É¢·Éï·Éò·É†·Éó·Éî·Éë·Éê...</div></div>
        </div>
        <div class="sidebox">
          <div style="margin-bottom:6px;font-weight:700;">·É©·Éî·Éõ·Éò ·É°·Éê·Éí·Éú·Éî·Éë·Éò</div>
          <div id="mySubjects"></div>
          <button id="saveSubjects" class="save">Save</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>



<!-- JS -->
<script>
const overlay = document.getElementById("loadingOverlay");

fetch("https://raw.githubusercontent.com/WEEKGE/live/main/config.json")
.then(r => r.json())
.then(cfg => {
  firebase.initializeApp(cfg);
  startWeekge();
})
.catch(() => {
  overlay.innerHTML = "<h2 style='color:red;text-align:center;margin-top:30vh;'>‚ö†Ô∏è config.json ·Éï·Éî·É† ·É©·Éê·Éò·É¢·Éï·Éò·É†·Éó·Éê.</h2>";
});

function startWeekge(){
  const auth = firebase.auth(), db = firebase.firestore();
  let user=null,catalog=[],selected=[],cache={},weekDates=[];
  const $=s=>document.querySelector(s);
  const el=(t,p={},kids=[])=>{const e=document.createElement(t);Object.assign(e,p);kids.forEach(k=>e.append(k));return e;};
  const todayISO=()=>new Date().toISOString().slice(0,10);
  const isBetween=(d,s,e)=>d>=s&&d<=e;
  const hasPassed=(d,e)=>d>e;
  const fmtRange=(s,e)=>{const f=d=>new Date(d+"T12:00:00").toLocaleString(undefined,{month:"short",day:"numeric"});return f(s)+" ‚Üí "+f(e);};

  const SEMESTER_WEEKS=[
    {n:1,start1:"2025-09-22",end1:"2025-09-28",start2:"2026-03-02",end2:"2026-03-08"},
    {n:2,start1:"2025-09-29",end1:"2025-10-05",start2:"2026-03-09",end2:"2026-03-15"},
    {n:3,start1:"2025-10-06",end1:"2025-10-12",start2:"2026-03-16",end2:"2026-03-22"},
    {n:4,start1:"2025-10-13",end1:"2025-10-19",start2:"2026-03-23",end2:"2026-03-29"},
    {n:5,start1:"2025-10-20",end1:"2025-10-26",start2:"2026-03-30",end2:"2026-04-05"},
    {n:6,start1:"2025-10-27",end1:"2025-11-02",start2:"2026-04-06",end2:"2026-04-12"},
    {n:7,start1:"2025-11-03",end1:"2025-11-09",start2:"2026-04-20",end2:"2026-04-26"},
    {n:8,start1:"2025-11-10",end1:"2025-11-16",start2:"2026-04-27",end2:"2026-05-03"},
    {n:9,start1:"2025-11-17",end1:"2025-11-23",start2:"2026-05-04",end2:"2026-05-10"},
    {n:10,start1:"2025-11-24",end1:"2025-11-30",start2:"2026-05-11",end2:"2026-05-17"},
    {n:11,start1:"2025-12-01",end1:"2025-12-07",start2:"2026-05-18",end2:"2026-05-24"},
    {n:12,start1:"2025-12-08",end1:"2025-12-14",start2:"2026-05-25",end2:"2026-05-31"}
  ];

  // === Color Map ===
  const colorMap = {
    yellow: ["#ffc423", "#fff"],
    green:  ["#38d98a", "#fff"],
    red:    ["#ed3737", "#fff"],
    blue:   ["#2979ff", "#fff"]
  };

  $("#weekToggle").onclick=()=>toggleWeeks();

  // === AUTH ===
  const provider=new firebase.auth.GoogleAuthProvider();
  $("#signinBtn").onclick=()=>auth.signInWithPopup(provider);
  $("#logoutBtn").onclick=()=>auth.signOut();
  $("#avatar").onclick=()=>$("#menu").classList.toggle("open");
  document.addEventListener("click",e=>{
    if(!e.target.closest(".avatar")&&!e.target.closest(".menu"))
      $("#menu").classList.remove("open");
  });

  $("#openProfile").onclick=async()=>{
    $("#menu").classList.remove("open");
    $("#modal").classList.add("open");
    if(!catalog.length) await loadCatalog();
    renderProfile();
  };
  $("#closeModal").onclick=()=>$("#modal").classList.remove("open");
  document.addEventListener("keydown",e=>{if(e.key==="Escape") $("#modal").classList.remove("open");});

  auth.onAuthStateChanged(async u=>{
    user=u||null;
    guardUI(!!user);
    if(user){
      $("#avatar").src=user.photoURL||"https://i.pravatar.cc/100";
      overlay.classList.add("hidden");
      await bootAfterLogin();
    } else overlay.classList.add("hidden");
  });

  function guardUI(signed){
    $("#signinBtn").style.display=signed?"none":"inline-flex";
    $("#avatar").style.display=signed?"block":"none";
    if(!signed)
      $("#cardsCanvas").innerHTML="<div class='empty'>·É®·Éî·Éì·Éò Google-·Éò·Éó ·É†·Éù·Éõ ·Éú·Éê·ÉÆ·Éù ·É°·Éê·Éí·Éú·Éî·Éë·Éò.</div>";
  }

  async function loadCatalog(){
    catalog=[];
    const snap=await db.collection("subjects").get();
    snap.forEach(d=>catalog.push({id:d.id,...d.data()}));
  }

  async function loadUserSelection(){
    const snap=await db.collection("users").doc(user.uid).get();
    selected=(snap.exists&&snap.data().subjects)||[];
  }

  async function ensureSubjectsLoaded(){
    const toLoad=selected.filter(id=>!cache[id]);
    for(const id of toLoad){
      const subj=catalog.find(c=>c.id===id);
      if(subj) cache[id]=subj;
    }
  }

  function flattenWeeks(){
    weekDates=[];
    SEMESTER_WEEKS.forEach(w=>{
      if(w.start1)weekDates.push({n:w.n,start:w.start1,end:w.end1});
      if(w.start2)weekDates.push({n:w.n,start:w.start2,end:w.end2});
    });
  }

  async function bootAfterLogin(){
    await Promise.all([loadCatalog(),loadUserSelection()]);
    await ensureSubjectsLoaded();
    flattenWeeks();
    paintWeeks();
    goToday();
  }

  function paintWeeks(){
    const iso=todayISO();
    const list=$("#weeksList"); list.innerHTML="";
    let activeWeekN=null;
    for(const w of SEMESTER_WEEKS){
      if(isBetween(iso,w.start1,w.end1)||isBetween(iso,w.start2,w.end2)){
        activeWeekN=w.n;break;
      }
    }

    SEMESTER_WEEKS.forEach(w=>{
      const isCurrent=activeWeekN===w.n;
      const done=hasPassed(iso,w.end1)&&hasPassed(iso,w.end2);
      const status=isCurrent?"current":done?"done":"pending";
      const row=el("div",{className:`week-item${isCurrent?" active":""}`});
      row.setAttribute("data-week",w.n);
      row.append(
        el("div",{className:"dot "+status}),
        el("div",{},[
          el("div",{className:"wk-title",textContent:`Week ${w.n}`}),
          el("div",{className:"wk-dates",textContent:fmtRange(w.start1,w.end1)+" / "+fmtRange(w.start2,w.end2)})
        ])
      );
      row.onclick=()=>{document.querySelectorAll(".week-item").forEach(x=>x.classList.remove("active"));row.classList.add("active");showWeek(w.n);toggleWeeks(false);updateWeekLabel(w.n);};
      list.append(row);
    });
    updateWeekLabel(activeWeekN);
  }

  function updateWeekLabel(n){$("#weekToggle").textContent=`üìÖ Week ${n||"-"} ‚ñº`; }

  function addBtns(wrap,weekObj){
    const btns=el("div",{className:"btns"});
    const add=(label,url,colorName)=>{const [bg,txt]=colorMap[colorName]||["#38d98a","#fff"];
      const b=el("button",{className:"pill",textContent:label,style:`background:${bg};color:${txt}`});
      if(url)b.onclick=()=>window.open(url,"_blank"); btns.append(b);
    };
    (weekObj.buttons||[]).forEach(b=>add(b.label,b.link,b.colorName||b.color||"green"));
    wrap.append(btns);
  }

  function addGlobalBtns(card,subj){
    if(subj.globalButtons && subj.globalButtons.length>0){
      const box=el("div",{className:"global-files"});
      box.append(el("h4",{textContent:"·Éõ·Éó·Éê·Éï·Éê·É†·Éò ·É§·Éê·Éò·Éö·Éî·Éë·Éò:"}));
      const btns=el("div",{className:"btns"});
      subj.globalButtons.forEach(b=>{
        const [bg,txt]=colorMap[b.colorName||b.color]||["#38d98a","#fff"];
        const btn=el("button",{className:"pill",textContent:b.label,style:`background:${bg};color:${txt}`});
        if(b.link) btn.onclick=()=>window.open(b.link,"_blank");
        btns.append(btn);
      });
      box.append(btns); card.append(box);
    }
  }

  function showWeek(n){
    const canvas=$("#cardsCanvas");
    canvas.style.opacity="0"; canvas.style.filter="blur(8px)";
    setTimeout(()=>{
      const stack=el("div",{className:"card-stack"});
      let any=false;
      selected.forEach(id=>{
        const subj=cache[id]; if(!subj)return;
        const cur=subj.weeks?.find(w=>w.week===n);
        const prev=(n>1)?subj.weeks?.find(w=>w.week===n-1):null;
        if(!cur&&!prev)return; any=true;
        const card=el("div",{className:"card"});
        card.append(el("div",{className:"subhead",textContent:subj.name}));

        // ‚úÖ NEW: Show type (week type) under subject title
        const typeText = cur?.type || prev?.type || null;
        if(typeText){
          const typeEl = el("div",{style:"text-align:center;font-size:0.9rem;opacity:0.8;margin-top:-6px;",textContent:typeText});
          card.append(typeEl);
        }

        addGlobalBtns(card,subj);
        const wrap=el("div",{className:"card-sections"});
        if(prev){const sec=el("div",{className:"card-section"});sec.append(el("h4",{textContent:`·Éê·Éõ ·Éô·Éï·Éò·É†·Éò·É°·Éó·Éï·Éò·É°:`}));addBtns(sec,prev);wrap.append(sec);}
        if(cur){const sec=el("div",{className:"card-section"});sec.append(el("h4",{textContent:`·É®·Éî·Éõ·Éì·Éî·Éí·Éò ·Éô·Éï·Éò·É†·Éò·É°·Éó·Éï·Éò·É°:`}));addBtns(sec,cur);wrap.append(sec);}
        card.append(wrap);
        stack.append(card);
      });
      canvas.innerHTML=""; canvas.append(any?stack:el("div",{className:"empty",textContent:"·Éê·Éõ ·Éô·Éï·Éò·É†·Éò·É°·Éó·Éï·Éò·É° ·Éõ·Éê·É°·Éê·Éö·Éê ·ÉØ·Éî·É† ·Éê·É†·Éê·Éê."}));
      canvas.style.filter="blur(0)"; canvas.style.opacity="1";
    },300);
  }

  function goToday(){
    const iso=todayISO();
    const cur=weekDates.find(w=>isBetween(iso,w.start,w.end))||weekDates[0];
    if(cur){
      showWeek(cur.n);
      updateWeekLabel(cur.n);
      document.querySelectorAll(".week-item").forEach(x=>x.classList.remove("active"));
      const currentEl=document.querySelector(`.week-item[data-week="${cur.n}"]`);
      if(currentEl)currentEl.classList.add("active");
    }
    toggleWeeks(false);
  }

  function toggleWeeks(force){
    const left=$("#weeksList");
    left.classList.toggle("open",force!==undefined?force:!left.classList.contains("open"));
  }

  function renderProfile(){
    const list=$("#catalogList");list.innerHTML="";
    const mine=$("#mySubjects");mine.innerHTML="";
    catalog.forEach(x=>{
      const added=selected.includes(x.id);
      const row=el("div",{className:"item"});
      row.append(
        el("div",{},[el("div",{textContent:x.name,style:"font-weight:700"}),el("div",{textContent:x.id,style:"font-size:12px;opacity:.7"})]),
        added?el("button",{className:"added",textContent:"‚úì Added"}):el("button",{textContent:"Add",onclick:async()=>{if(!selected.includes(x.id))selected.push(x.id);await saveSelection(true);renderProfile();}})
      );
      list.append(row);
    });
    selected.forEach(id=>{
      const subj=catalog.find(c=>c.id===id);
      const row=el("div",{className:"item"});
      row.append(
        el("div",{},[el("div",{textContent:subj?subj.name:id,style:"font-weight:700"}),el("div",{textContent:id,style:"font-size:12px;opacity:.7"})]),
        el("button",{textContent:"Remove",onclick:async()=>{selected=selected.filter(s=>s!==id);delete cache[id];await saveSelection(true);renderProfile();}})
      );
      mine.append(row);
    });
    $("#saveSubjects").onclick=async()=>{await saveSelection(true);};
  }

  async function saveSelection(immediate=false){
    if(!user)return;
    await db.collection("users").doc(user.uid).set({subjects:selected},{merge:true});
    if(immediate){
      await ensureSubjectsLoaded(); paintWeeks(); goToday();
    }
  }
}
</script>






</body>
</html>
