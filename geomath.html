<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GE Speech â†’ LaTeX</title>

<!-- MathJax for rendering LaTeX -->
<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
  svg: { fontCache: 'global' }
};
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
  :root{
    color-scheme: dark;
    --bg:#0C1A22; --panel:#132029; --accent:#ED3737; --text:#fff; --muted:#9fb0bb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .wrap{max-width:960px;margin:auto;padding:24px;display:grid;gap:18px}
  header{display:flex;align-items:center;gap:12px;justify-content:space-between}
  h1{margin:0;font-size:22px}
  .hint{font-size:13px;color:var(--muted)}
  .grid{display:grid;gap:16px}
  @media(min-width:880px){ .grid{grid-template-columns:300px 1fr} }

  /* Mic button */
  .mic{
    width:84px;height:84px;border-radius:50%;
    display:grid;place-items:center;cursor:pointer;border:none;
    background:radial-gradient(100% 100% at 50% 0%, #ff7a7a 0, #b90f0f 100%);
    box-shadow:0 10px 30px rgba(237,55,55,.35), inset 0 2px 10px rgba(255,255,255,.2);
    transition:transform .15s ease, filter .2s ease, box-shadow .2s ease;
  }
  .mic:hover{transform:translateY(-1px);filter:brightness(1.05)}
  .mic.on{animation:pulse 1.2s ease-in-out infinite}
  @keyframes pulse{
    0%{box-shadow:0 0 0 0 rgba(237,55,55,.5)}
    70%{box-shadow:0 0 0 18px rgba(237,55,55,0)}
    100%{box-shadow:0 0 0 0 rgba(237,55,55,0)}
  }
  .mic svg{width:38px;height:38px;fill:white}

  .panel{
    background:var(--panel);
    border:1px solid #22323c;border-radius:14px;padding:16px;display:grid;gap:12px
  }
  .label{font-size:12px;color:var(--muted);letter-spacing:.04em;text-transform:uppercase}
  .box{
    background:#0f1a22;border:1px solid #1f2b35;border-radius:10px;
    padding:12px;min-height:48px
  }
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .btn{
    appearance:none;border:none;cursor:pointer;border-radius:10px;padding:10px 14px;
    background:#1b2a34;color:#fff;border:1px solid #2a3b47;font-size:14px
  }
  .btn:hover{background:#213440}
  .btn:active{transform:translateY(1px)}
  .btn.accent{background:var(--accent);border-color:#b80f0f}
  .eq-render{padding:18px 12px;font-size:22px}
  code.kbd{
    font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    background:#0b141a;border:1px solid #1f2b35;border-radius:6px;padding:2px 6px;color:#c7d6de
  }

  .legend{display:grid;gap:8px;font-size:14px;color:#c7d6de}
  .legend b{color:#fff}
  .small{font-size:12px;color:#9fb0bb}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸ¤ áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ áƒ¡áƒ˜áƒ¢áƒ§áƒ•áƒ â†’ LaTeX áƒ¤áƒáƒ áƒ›áƒ£áƒšáƒ</h1>
      <div class="hint">áƒ›áƒáƒ™áƒšáƒ”áƒ“: áƒ“áƒáƒáƒ­áƒ˜áƒ áƒ” áƒ¬áƒ áƒ”áƒ¡, áƒ—áƒ¥áƒ•áƒ˜ áƒ¤áƒáƒ áƒ›áƒ£áƒšáƒ (â€áƒ˜áƒ¥áƒ¡ áƒáƒšáƒ˜áƒ£áƒ¡ áƒáƒ áƒ˜ áƒ¢áƒáƒšáƒ˜áƒ áƒ¡áƒáƒ›áƒ¡â€œ) áƒ“áƒ áƒ›áƒ˜áƒ˜áƒ¦áƒ”áƒ‘ LaTeX-áƒ¡.</div>
    </header>

    <div class="grid">
      <!-- Left: Controls -->
      <div class="panel">
        <div class="label">áƒ›áƒ˜áƒ™áƒ áƒáƒ¤áƒáƒœáƒ˜</div>
        <div style="display:flex;align-items:center;gap:14px">
          <button id="micBtn" class="mic" title="Start / Stop">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 1 0-6 0v5a3 3 0 0 0 3 3Zm5-3a5 5 0 1 1-10 0H5a7 7 0 0 0 14 0h-2Zm-5 7a7.002 7.002 0 0 1-6.32-4H3.9A9.002 9.002 0 0 0 11 21.95V24h2v-2.05A9.002 9.002 0 0 0 20.1 14h-1.78A7.002 7.002 0 0 1 12 18Z"/>
            </svg>
          </button>
          <div>
            <div class="small">áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜: <span id="status">áƒ›áƒ–áƒáƒ“áƒáƒ</span></div>
            <div class="small">áƒ”áƒœáƒ: <code class="kbd">ka-GE</code></div>
          </div>
        </div>

        <div class="label">áƒ áƒáƒ›áƒ”áƒšáƒ˜ áƒ¡áƒ˜áƒ¢áƒ§áƒ•áƒ”áƒ‘áƒ˜ áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡</div>
        <div class="legend box">
          <div><b>áƒáƒáƒ”áƒ áƒáƒ¢áƒáƒ áƒ”áƒ‘áƒ˜:</b> â€áƒáƒšáƒ˜áƒ£áƒ¡â€œ, â€áƒ›áƒ˜áƒœáƒ£áƒ¡â€œ, â€áƒ¯áƒ”áƒ /áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒâ€œ, â€áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜â€œ</div>
          <div><b>áƒ¢áƒáƒšáƒ˜áƒ:</b> â€áƒ¢áƒáƒšáƒ˜áƒâ€œ, â€áƒ¢áƒáƒšáƒ˜â€œ, â€áƒ’áƒáƒ—áƒáƒœáƒáƒ‘áƒ áƒ“áƒ”áƒ‘áƒâ€œ</div>
          <div><b>áƒªáƒ•áƒšáƒáƒ“áƒ”áƒ‘áƒ˜:</b> â€áƒ˜áƒ¥áƒ¡â€œ, â€áƒ˜áƒ’áƒ áƒ”áƒ™â€œ, â€áƒ–áƒ”áƒ¢/áƒ–áƒ”áƒ“áƒ˜â€œ</div>
          <div><b>áƒ¤áƒ áƒ©áƒ®áƒ˜áƒšáƒ”áƒ‘áƒ˜:</b> â€áƒ¦áƒ˜áƒ áƒ¤áƒ áƒ©áƒ®áƒ˜áƒšáƒ˜â€œ, â€áƒ“áƒáƒ®áƒ£áƒ áƒ£áƒšáƒ˜ áƒ¤áƒ áƒ©áƒ®áƒ˜áƒšáƒ˜â€œ</div>
          <div><b>áƒ®áƒáƒ áƒ˜áƒ¡áƒ®áƒ˜:</b> â€áƒ™áƒ•áƒáƒ“áƒ áƒáƒ¢áƒ˜â€œ (^{2}), â€áƒ™áƒ£áƒ‘áƒ˜â€œ (^{3}) â€“ áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡ áƒ¬áƒ˜áƒœáƒ áƒªáƒ•áƒšáƒáƒ“áƒ–áƒ”</div>
          <div><b>áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ”áƒ‘áƒ˜:</b> â€áƒ¡áƒ˜áƒœáƒ£áƒ¡â€œ, â€áƒ™áƒáƒ¡áƒ˜áƒœáƒ£áƒ¡â€œ, â€áƒ¢áƒáƒœáƒ’áƒ”áƒœáƒ¡â€œ, â€áƒšáƒáƒ’áƒáƒ áƒ˜áƒ—áƒ›áƒ˜â€œ + â€áƒ¦áƒ˜áƒ/áƒ“áƒáƒ®. áƒ¤áƒ áƒ©áƒ®áƒ˜áƒšáƒ˜ ...â€œ</div>
          <div><b>áƒ¤áƒ”áƒ¡áƒ•áƒ˜:</b> â€áƒ¤áƒ”áƒ¡áƒ•áƒ˜ xâ€œ â†’ \sqrt{x}</div>
          <div class="small">áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜: â€áƒ˜áƒ¥áƒ¡ áƒáƒšáƒ˜áƒ£áƒ¡ áƒáƒ áƒ˜ áƒ¢áƒáƒšáƒ˜áƒ áƒ¡áƒáƒ›áƒ˜â€œ â†’ <code class="kbd">x + 2 = 3</code></div>
        </div>

        <div class="row">
          <button id="clearBtn" class="btn">áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ</button>
          <button id="copyLatexBtn" class="btn">LaTeX áƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ</button>
          <button id="copyTextBtn" class="btn">áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜áƒ¡ áƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ</button>
        </div>
      </div>

      <!-- Right: Output -->
      <div class="panel">
        <div class="label">áƒáƒ›áƒáƒ¦áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ (áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒáƒ“)</div>
        <div id="heard" class="box" contenteditable="true" spellcheck="false" aria-label="à¹à¸">
          <!-- live text appears here -->
        </div>

        <div class="label">LaTeX áƒ™áƒáƒ“áƒ˜</div>
        <div id="latex" class="box" style="font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace;white-space:pre-wrap"></div>

        <div class="label">áƒ áƒ”áƒœáƒ“áƒ”áƒ áƒ˜</div>
        <div id="render" class="box eq-render">â€”</div>
      </div>
    </div>
  </div>



<script>
/* ========= Georgian â†’ LaTeX Smart Parser v20 ========= */
/* Supports: greek letters, latin letters (áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒáƒ“ áƒœáƒáƒ—áƒ¥áƒ•áƒáƒ›áƒ˜), integral, fractions, roots, parentheses, phonetic & noise filter */

function normalizeWords(text){
  const map = {
    'áƒ¡áƒáƒ›áƒ¡':'áƒ¡áƒáƒ›áƒ˜','áƒ¡áƒáƒ›áƒ–áƒ”':'áƒ¡áƒáƒ›áƒ˜','áƒ¡áƒáƒ›áƒ˜áƒ“áƒáƒœ':'áƒ¡áƒáƒ›áƒ˜','áƒ¡áƒáƒ›áƒ˜áƒ¡':'áƒ¡áƒáƒ›áƒ˜',
    'áƒáƒ áƒ¡':'áƒáƒ áƒ˜','áƒáƒ áƒ˜áƒ“áƒáƒœ':'áƒáƒ áƒ˜','áƒáƒ áƒ–áƒ”':'áƒáƒ áƒ˜','áƒáƒ áƒ˜áƒ¡':'áƒáƒ áƒ˜',
    'áƒ®áƒ£áƒ—áƒ˜áƒ¡':'áƒ®áƒ£áƒ—áƒ˜','áƒ®áƒ£áƒ—áƒ¡':'áƒ®áƒ£áƒ—áƒ˜','áƒ®áƒ£áƒ—áƒ˜áƒ“áƒáƒœ':'áƒ®áƒ£áƒ—áƒ˜',
    'áƒ”áƒ¥áƒ•áƒ¡áƒ˜áƒ¡':'áƒ”áƒ¥áƒ•áƒ¡áƒ˜','áƒ”áƒ¥áƒ•áƒ¡áƒ¡':'áƒ”áƒ¥áƒ•áƒ¡áƒ˜','áƒœáƒ£áƒšáƒ¡':'áƒœáƒ£áƒšáƒ˜',
  };
  for(const [k,v] of Object.entries(map)){
    const re = new RegExp(k,'g');
    text = text.replace(re,v);
  }
  return text;
}

/* --- Noise Filter: remove irrelevant words --- */
function removeNonMathWords(str){
  const blacklist = [
    'áƒ‘áƒáƒ•áƒ¨', 'áƒ›áƒáƒœáƒ¥áƒáƒœ', 'áƒ¡áƒáƒ®áƒš', 'áƒ«áƒáƒ¦áƒš', 'áƒ™áƒáƒ¢', 'áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœ', 'áƒ™áƒáƒ›áƒáƒ˜áƒ£áƒ¢', 
    'áƒ¤áƒ˜áƒšáƒ›', 'áƒ¡áƒ£áƒ áƒáƒ—', 'áƒ›áƒ”áƒ’áƒáƒ‘', 'áƒ¡áƒ˜áƒ§áƒ•áƒáƒ ', 'áƒ‘áƒáƒ¦', 'áƒ’áƒ–áƒ', 'áƒ¬áƒ˜áƒ’áƒœ', 'áƒ­áƒáƒ›'
  ];
  for(const bad of blacklist){
    const re = new RegExp(`\\b${bad}[áƒ-áƒ°]*\\b`, 'gi');
    str = str.replace(re,'');
  }
  return str.trim();
}

/* --- Fix common merge + phonetic errors --- */
function fixMergedSpeech(str){
  const fixes = [
    [/áƒ¤áƒšáƒ˜áƒ£áƒ¡/g,'áƒáƒšáƒ˜áƒ£áƒ¡'], [/áƒ¤áƒšáƒ£áƒ¡/g,'áƒáƒšáƒ˜áƒ£áƒ¡'], [/áƒ¤áƒšáƒ˜áƒ£áƒ–/g,'áƒáƒšáƒ˜áƒ£áƒ¡'],
    [/áƒ›áƒ˜áƒœáƒ£áƒ¨/g,'áƒ›áƒ˜áƒœáƒ£áƒ¡'], [/áƒ›áƒ˜áƒœáƒ£áƒ¡áƒ£áƒ /g,'áƒ›áƒ˜áƒœáƒ£áƒ¡'],
    [/áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”(áƒ‘áƒ|áƒ‘áƒ£áƒšáƒ˜)?/g,'áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜'],
    [/áƒ’áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ’áƒáƒ®áƒ•áƒ˜áƒšáƒ˜/g,'áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜'],
    [/áƒ¤áƒ”áƒ©(áƒ˜|áƒ”)?/g,'áƒ¤áƒ”áƒ¡áƒ•áƒ˜'],
    // áƒ˜áƒœáƒ¢áƒ”áƒ’áƒ áƒáƒšáƒ˜
    [/áƒ˜áƒœáƒ¢áƒ”áƒ’áƒ áƒáƒš(áƒ˜|áƒ˜áƒ—|áƒ¨áƒ˜|áƒ–áƒ”|áƒ˜áƒ¡)?/g,'âˆ«'],
    [/áƒ˜áƒœáƒ¢áƒ”áƒ’áƒáƒšáƒ˜/g,'âˆ«'], [/áƒ˜áƒœáƒ¢áƒ”áƒ’áƒáƒš(áƒ˜áƒ—|áƒ¨áƒ˜)?/g,'âˆ«'], [/áƒ˜áƒœáƒ¢áƒ”áƒ’áƒ áƒšáƒ˜/g,'âˆ«'],
    // áƒ¨áƒ•áƒ˜áƒ“áƒ˜áƒ¡ áƒ›áƒ¡áƒ’áƒáƒ•áƒ¡áƒ˜
    [/áƒ¨áƒ•áƒ˜áƒ–áƒ”|áƒ¨áƒ•áƒ˜áƒ«áƒ”|áƒ¨áƒ•áƒ˜áƒ¢áƒ–áƒ”|áƒ¨áƒ•áƒ˜áƒ“áƒ|áƒ¨áƒ•áƒ˜áƒ–|áƒ¨áƒ•áƒ˜áƒ¬áƒ”|áƒ¨áƒ•áƒ˜áƒªáƒ”/g,'áƒ¨áƒ•áƒ˜áƒ“áƒ–áƒ”'],
    [/áƒ¨áƒ£áƒ•áƒ˜áƒš|áƒ¨áƒ•áƒ˜áƒš(áƒ˜|áƒ¡|áƒ¨áƒ˜|áƒ˜áƒ—)?/g,'áƒ¨áƒ•áƒ˜áƒ“áƒ˜']
  ];
  for(const [re,rep] of fixes){ str = str.replace(re,rep); }
  return str;
}

/* --- Multiply & Divide --- */
function fixMultiplyDivideNumbers(str){
  const multPatterns = [
    {re: /(áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ¯áƒ”áƒ )\s+(áƒ”áƒ áƒ—(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '\\cdot 1'},
    {re: /(áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ¯áƒ”áƒ )\s+(áƒáƒ (áƒ–áƒ”|áƒ«áƒ”))/g, rep: '\\cdot 2'},
    {re: /(áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ¯áƒ”áƒ )\s+(áƒ¡áƒáƒ›(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '\\cdot 3'},
    {re: /(áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ¯áƒ”áƒ )\s+(áƒáƒ—áƒ®(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '\\cdot 4'},
    {re: /(áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ¯áƒ”áƒ )\s+(áƒ®áƒ£áƒ—(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '\\cdot 5'},
    {re: /(áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ¯áƒ”áƒ )\s+(áƒ”áƒ¥áƒ•áƒ¡(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '\\cdot 6'},
    {re: /(áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ¯áƒ”áƒ )\s+(áƒ¨áƒ•áƒ˜áƒ“(áƒ–áƒ”|áƒ«áƒ”|áƒ¬áƒ”|áƒªáƒ”))/g, rep: '\\cdot 7'},
    {re: /(áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ¯áƒ”áƒ )\s+(áƒ áƒ•áƒ(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '\\cdot 8'},
    {re: /(áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ¯áƒ”áƒ )\s+(áƒªáƒ®áƒ (áƒáƒ–áƒ”|áƒ«áƒ”))/g, rep: '\\cdot 9'},
    {re: /(áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ¯áƒ”áƒ )\s+(áƒáƒ—(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '\\cdot 10'},
  ];
  const divPatterns = [
    {re: /(áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ¨áƒ”áƒ¤áƒáƒ áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜)\áƒ¡+(áƒ”áƒ áƒ—(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '/1'},
    {re: /(áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ¨áƒ”áƒ¤áƒáƒ áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜)\áƒ¡+(áƒáƒ (áƒ–áƒ”|áƒ«áƒ”))/g, rep: '/2'},
    {re: /(áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ¨áƒ”áƒ¤áƒáƒ áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜)\áƒ¡+(áƒ¡áƒáƒ›(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '/3'},
    {re: /(áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ¨áƒ”áƒ¤áƒáƒ áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜)\áƒ¡+(áƒáƒ—áƒ®(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '/4'},
    {re: /(áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ¨áƒ”áƒ¤áƒáƒ áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜)\áƒ¡+(áƒ®áƒ£áƒ—(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '/5'},
    {re: /(áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ¨áƒ”áƒ¤áƒáƒ áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜)\áƒ¡+(áƒ”áƒ¥áƒ•áƒ¡(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '/6'},
    {re: /(áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ¨áƒ”áƒ¤áƒáƒ áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜)\áƒ¡+(áƒ¨áƒ•áƒ˜áƒ“(áƒ–áƒ”|áƒ«áƒ”|áƒ¬áƒ”|áƒªáƒ”))/g, rep: '/7'},
    {re: /(áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ¨áƒ”áƒ¤áƒáƒ áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜)\áƒ¡+(áƒ áƒ•áƒ(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '/8'},
    {re: /(áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ¨áƒ”áƒ¤áƒáƒ áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜)\áƒ¡+(áƒªáƒ®áƒ (áƒáƒ–áƒ”|áƒ«áƒ”))/g, rep: '/9'},
    {re: /(áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ¨áƒ”áƒ¤áƒáƒ áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜)\áƒ¡+(áƒáƒ—(áƒ–áƒ”|áƒ«áƒ”))/g, rep: '/10'},
  ];
  for(const {re,rep} of multPatterns){ str = str.replace(re, rep); }
  for(const {re,rep} of divPatterns){ str = str.replace(re, rep); }
  return str;
}

/* --- Replace numbers --- */
function replaceNumbers(str){
  const numMap = {
    'áƒœáƒ£áƒšáƒ˜':'0','áƒ”áƒ áƒ—áƒ˜':'1','áƒáƒ áƒ˜':'2','áƒ¡áƒáƒ›áƒ˜':'3','áƒáƒ—áƒ®áƒ˜':'4',
    'áƒ®áƒ£áƒ—áƒ˜':'5','áƒ”áƒ¥áƒ•áƒ¡áƒ˜':'6','áƒ¨áƒ•áƒ˜áƒ“áƒ˜':'7','áƒ áƒ•áƒ':'8','áƒªáƒ®áƒ áƒ':'9','áƒáƒ—áƒ˜':'10'
  };
  for (const [ka, num] of Object.entries(numMap)){
    const re = new RegExp(ka,'g');
    str = str.replace(re,num);
  }
  return str;
}

/* --- Greek & Latin letters --- */
function detectLetters(str){
  const greekMap = {
    'áƒáƒšáƒ¤áƒ':'\\alpha','áƒ‘áƒ”áƒ¢áƒ':'\\beta','áƒ’áƒáƒ›áƒ':'\\gamma','áƒáƒ›áƒ”áƒ’áƒ':'\\omega'
  };
  for(const [ka, sym] of Object.entries(greekMap)){
    const re = new RegExp(ka,'g');
    str = str.replace(re,sym);
  }

  // Latin (spoken Georgian variants)
  const latinMap = {
    'áƒ':'a','áƒ‘áƒ”':'b','áƒªáƒ”':'c','áƒ“áƒ”':'d','áƒ’áƒ”':'g','áƒ”áƒœ':'n','áƒ”áƒ›':'m','áƒ™áƒ':'k',
    'áƒ–áƒ”áƒ¢áƒ˜':'z','áƒ˜':'i','áƒ”':'e','áƒ£':'u','áƒ˜áƒ’áƒ áƒ”áƒ™áƒ˜':'y','áƒ˜áƒ¥áƒ¡áƒ˜':'x'
  };
  str = str.replace(/áƒ“áƒ˜áƒ“áƒ˜\s+([áƒ-áƒ°]+)/g, (_,ka)=>{
    const small = latinMap[ka] || 'x';
    return small.toUpperCase();
  });
  for(const [ka, sym] of Object.entries(latinMap)){
    const re = new RegExp(`\\b${ka}\\b`,'g');
    str = str.replace(re,sym);
  }
  return str;
}

/* --- Fractions --- */
function detectFractions(str){
  const fracs = [
    [/áƒ”áƒ áƒ—áƒ˜\s+áƒ›áƒ”áƒáƒ (áƒ”|áƒ”áƒ“áƒ˜)/g, '\\frac{1}{2}'],
    [/áƒáƒ áƒ˜\s+áƒ›áƒ”áƒ¡áƒáƒ›(áƒ”|áƒ”áƒ“áƒ˜)/g, '\\frac{2}{3}'],
    [/áƒ¡áƒáƒ›áƒ˜\s+áƒ›áƒ”áƒáƒ—áƒ®(áƒ”|áƒ”áƒ“áƒ˜)/g, '\\frac{3}{4}'],
  ];
  for(const [re,rep] of fracs){ str = str.replace(re,rep); }
  return str;
}

/* --- Parser --- */
function parseExpression(str){
  str = removeNonMathWords(str);
  str = fixMergedSpeech(str);
  str = fixMultiplyDivideNumbers(str);
  str = normalizeWords(str);
  str = detectFractions(str);
  str = replaceNumbers(str);
  str = detectLetters(str);

  str = str
    .replace(/áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ›áƒ˜áƒ›áƒáƒ¢áƒ”áƒ‘áƒ£áƒšáƒ˜|áƒáƒšáƒ˜áƒ£áƒ¡/g,'+')
    .replace(/áƒ’áƒáƒ›áƒáƒ™áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ“áƒáƒ™áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ›áƒ˜áƒœáƒ£áƒ¡/g,'-')
    .replace(/áƒ’áƒáƒ›áƒ áƒáƒ•áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜|áƒ¯áƒ”áƒ /g,'\\cdot')
    .replace(/áƒ’áƒáƒ§áƒáƒ¤áƒ˜áƒšáƒ˜|áƒ¨áƒ”áƒ¤áƒáƒ áƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜/g,'/')
    .replace(/áƒ¢áƒáƒšáƒ˜áƒ|áƒ£áƒ“áƒ áƒ˜áƒ¡/g,'=')
    .replace(/âˆ«/g,'\\int ')
    .replace(/áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’/g,' ');
  return str.trim();
}

/* --- Parentheses --- */
function handleParentheses(str){
  if (str.includes('áƒ¤áƒ áƒ©áƒ®áƒ˜áƒšáƒ”áƒ‘áƒ¨áƒ˜')){
    const before = str.split('áƒ¤áƒ áƒ©áƒ®áƒ˜áƒšáƒ”áƒ‘áƒ¨áƒ˜')[0] || '';
    const after = str.split('áƒ¤áƒ áƒ©áƒ®áƒ˜áƒšáƒ”áƒ‘áƒ¨áƒ˜')[1];
    const parts = after.split('áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’');
    const inside = parseExpression(parts[0] || '');
    const outside = parseExpression(parts[1] || '');
    return `${before}(${inside})${outside ? ' '+outside : ''}`;
  }
  return parseExpression(str);
}

/* --- Root & main --- */
function kaToLatex(inputRaw){
  if (!inputRaw) return '';
  let s = inputRaw.toLowerCase().trim();
  s = removeNonMathWords(s);
  s = fixMergedSpeech(s);
  s = normalizeWords(s).replace(/\s+/g,' ');

  if (s.includes('áƒ¤áƒ”áƒ¡áƒ•')){
    if (s.includes('áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’')){
      const parts = s.split('áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’');
      const inside = parseExpression(parts[0].replace(/áƒ¤áƒ”áƒ¡áƒ•(áƒ˜)?\áƒ¡*/,'')); 
      const outside = parseExpression(parts[1]);
      return `\\sqrt{${inside}} + ${outside}`;
    } else {
      const arg = s.replace(/áƒ¤áƒ”áƒ¡áƒ•(áƒ˜)?\áƒ¡*/,'');
      return `\\sqrt{${parseExpression(arg)}}`;
    }
  }

  const expr = handleParentheses(s);
  return expr || '';
}

/* ========= UI + Speech ========= */
const micBtn = document.getElementById('micBtn');
const statusEl = document.getElementById('status');
const heardEl = document.getElementById('heard');
const latexEl = document.getElementById('latex');
const renderEl = document.getElementById('render');
let rec = null, listening = false, interimText = '';

function ensureSR(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR){ alert('SpeechRecognition áƒáƒ  áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡ áƒáƒ› áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ–áƒ” ğŸ˜ áƒ¡áƒªáƒáƒ“áƒ” Chrome Desktop.'); return null; }
  return SR;
}

function startListen(){
  const SR = ensureSR(); if (!SR) return;
  if (!rec){ 
    rec = new SR(); rec.continuous = true; rec.interimResults = true; rec.lang = 'ka-GE';
    rec.onstart = ()=>{ statusEl.textContent='ğŸ¤ áƒ›áƒáƒ¡áƒ›áƒ”áƒœáƒ...'; micBtn.classList.add('on'); listening=true; };
    rec.onend = ()=>{ statusEl.textContent='áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ'; micBtn.classList.remove('on'); listening=false; };
    rec.onerror = e=>{ statusEl.textContent='áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: '+(e.error||''); };
    rec.onresult = evt=>{
      let finalChunk='',interim='';
      for(let i=evt.resultIndex;i<evt.results.length;i++){
        const tr=evt.results[i][0].transcript;
        if(evt.results[i].isFinal) finalChunk+=tr+' '; else interim+=tr;
      }
      if(finalChunk) heardEl.textContent+=finalChunk;
      interimText=interim; updateLatex();
    };
  }
  try{ rec.start(); }catch(_){}
}
function stopListen(){ if(rec&&listening) rec.stop(); }
micBtn.addEventListener('click',()=>{ listening?stopListen():startListen(); });
function getFullHeard(){ const manual=heardEl.textContent||''; return (manual+' '+interimText).trim(); }
function updateLatex(){
  const text=getFullHeard();
  const latex=kaToLatex(text);
  latexEl.textContent=latex||'â€”';
  renderEl.innerHTML=latex?`$${latex}$`:'â€”';
  if(window.MathJax&&MathJax.typesetPromise) MathJax.typesetPromise([renderEl]);
}
heardEl.addEventListener('input',updateLatex);
updateLatex();
</script>







</body>
</html>
